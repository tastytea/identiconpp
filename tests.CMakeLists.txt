if(WITH_TESTS)
    find_package(Catch2)
    if(Catch2_FOUND)
        set(MYCATCH, Catch2::Catch2)
    else()
        if(EXISTS "/usr/include/catch.hpp")
            message(STATUS "Catch 1.x found.")
            set(MYCATCH, "")
        else()
            message(FATAL_ERROR
                    "Neither Catch 2.x nor Catch 1.x could be found.")
        endif()
    endif()
    include(CTest)

    file(GLOB sources_tests src/tests/test_*.cpp)
    foreach(src ${sources_tests})
        get_filename_component(bin ${src} NAME_WE)
        add_executable(${bin} src/tests/main.cpp ${src})
        target_link_libraries(${bin} ${CMAKE_PROJECT_NAME} ${MYCATCH})
        target_include_directories(${bin} PRIVATE "/usr/include/catch2")
        add_test(${bin} ${bin})
    endforeach()
endif()
